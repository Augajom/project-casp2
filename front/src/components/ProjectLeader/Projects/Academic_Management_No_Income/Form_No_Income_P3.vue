<template>
  <div>
      <NavbarProject class="fixed-top " propText="‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ" />
      <ProgressBar class="fixed-top border"  :step="currentStep" @update:step="currentStep" />
      <Loader v-if="loading" />
      <div class="container-fluid d-flex justify-content-center" style="max-height: auto;margin-top: 230px;">
        <div class="d-flex flex-column  border p-4 shadow mb-5 "
          style="max-width: 1200px;min-width: 1200px;background-color: #374375;border-radius: 12px;height: auto;">
          <div class="row text-white fs-3 mt-3">
            <p>
              ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î
            </p>
          </div>
          <div class="row p-4">
            <div class="mb-2">
              <p class="text-white fs-5 ">
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÅ‡∏°‡πà‡∏ü‡πâ‡∏≤‡∏´‡∏•‡∏ß‡∏á ‡πÅ‡∏•‡∏∞/‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ú‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
              </p>
              <div>
                <textarea type="text" class="form-control beautiful-box" v-model="Project_Data_P3.projectDetails" style="max-width: 100%; min-width: 100%; height: 15px;"
                  :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•`"></textarea>
              </div>
            </div>
            <hr class="text-white mt-2">
            <div class="mb-2">
              <p class="text-white fs-5 ">
                ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
              </p>
              <div v-for="( objective ,index ) in Project_Data_P3.projectObjectives" :key="index">
                <div v-if="index+1 == 1">
                  <textarea type="text" class="form-control beautiful-box" v-model="objective.value"  style="max-width: 100%; min-width: 100%; height: 15px;"
                  :placeholder="`‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£`" ></textarea>
                </div>
                <div class="row mt-3" v-else>
                  <div class="col-10">
                    <textarea type="text" class="form-control beautiful-box" style="max-width: 100%; min-width: 100%; height: 15px;"
                    :placeholder="`‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£`" v-model="objective.value" ></textarea>
                  </div>
                  <div class="col-2 d-flex justify-content-center align-items-center">
                    <div @click="decrease_Objective(index)" class="btn btn-danger p-2">
                        ‡∏•‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-2 d-flex justify-content-center">
              <button class="btn mt-2" @click="addObjective()"  :disabled="is_objective_limit" style="width: 200px; background-color: #0d6efd; color: white;">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
              </button>
            </div>
            <hr class="text-white mt-3">
            <div class="mt-3">
              <p class="text-white fs-4 mb-0">
                ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏π‡πà‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (Impact Pathway)
              </p>
            </div>
            <div class="mb-1 mt-0">
              <div class="p-2">
                <span class="text-white fs-5 mb-0">
                  1. Input ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ :
                  ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°
                  ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢
                </span>
                <div class="p-2">
                  <p class="text-white fs-6 mb-0">
                    1.1 ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                  </p>
                  <p class="text-white fs-6 mb-0">
                    1.2 ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏£
                  </p>
                  <p class="text-white fs-6 mb-0">
                    1.3 ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                  </p>
                </div>
              </div>

              <div class="mt-3 mb-1">
                <div class="mt-3" v-for="(input,index) in Project_Data_P3.input" :key="index">
                  <div v-if="index == 0">
                    <textarea type="text" class="form-control beautiful-box" v-model="input.value" style="max-width: 100%; min-width: 100%; height: 15px;" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 1.${index + 4}`"></textarea>
                  </div>
                  <div v-else>
                    <div class="row">
                      <div class="col-10">
                        <textarea type="text" class="form-control beautiful-box" v-model="input.value"  style="max-width: 100%; min-width: 100%; height: 15px;" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 1.${index + 4}`"></textarea>
                      </div>
                      <div class="col-2 d-flex justify-content-center align-items-center">
                        <button @click="decrease_input(index)" class="btn btn-danger">‡∏•‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-center">
                <button @click="addInput" :disabled="is_input_limit" class="btn mt-3" style="width: 200px; background-color: #0d6efd; color: white;"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ </button>
              </div>
            </div>
            <div class="mb-1 mt-0">
              <span class="text-white fs-5 mb-0">
                2. Output ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏ô‡∏∞ (Competency, Competence)
                (‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à)
              </span>
              <div class="p-2">
                <p class="text-white fs-6 mb-0">
                  2.1 ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 80
                </p>
                <p class="text-white fs-6 mb-0">
                  2.2 ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 4.50
                </p>
              </div>

              <div class="mt-3 mb-1">
                <div class="mt-3" v-for="(output,index) in Project_Data_P3.outputs" :key="index">
                  <div v-if="index == 0">
                    <textarea class="form-control beautiful-box" v-model="output.value"  style="width: 100%; resize: vertical;" rows="1" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 2.${index+3}`"></textarea>
                  </div>
                  <div v-else>
                    <div class="row align-items-center">
                      <div class="col-10">
                        <textarea class="form-control beautiful-box" v-model="output.value"  style="width: 100%; resize: vertical;" rows="1" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 2.${index+3}`"></textarea>
                      </div>
                      <div class="col-2 d-flex justify-content-center align-items-center">
                        <button @click="decrease_output(index)" class="btn btn-danger" style="width: 100%; max-width: 120px;">‡∏•‡∏ö‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡∏µ‡πâ</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="d-flex justify-content-center">
                <button @click="addOutput" class="btn mt-3" style="width: 200px; background-color: #0d6efd; color: white;"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï </button>
              </div>
            </div>
            <div class="mb-1 mt-0">
              <span class="text-white fs-5 mb-0">
                3. Outcome ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï)
              </span>
              <div class="p-2">
                <p class="text-white fs-6 mb-0">
                  3.1 User ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£
                  ‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (User) ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö
                </p>
              </div>

              <div class="mt-3 mb-1">
                <div class="mt-3" v-for="(outcome_user,index) in Project_Data_P3.outcome_user" :key="index">
                  <div v-if="index == 0">
                    <textarea type="text" class="form-control beautiful-box" v-model="outcome_user.value" style="max-width: 100%; min-width: 100%; height: 15px;" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 3.1.${index + 1}`"></textarea>
                  </div>
                  <div v-else>
                    <div class="row">
                      <div class="col-10">
                        <textarea type="text" class="form-control beautiful-box" v-model="outcome_user.value" style="max-width: 100%; min-width: 100%; height: 15px;" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 3.1.${index + 1}`"></textarea>
                      </div>
                      <div class="col-2 d-flex justify-cotent-center align-items-center">
                        <button @click="decrease_outcome_user(index)" class="btn btn-danger">‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ô‡∏µ‡πâ</button>
                      </div>
                    </div>
                  </div>
                </div>
                
              </div>
              <div class="d-flex justify-content-center">
                <button class="btn mt-3" @click="addOutcomeUser" :disabled="is_outcome_user_limit" style="width: 200px; background-color: #0d6efd; color: white;"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå </button>
              </div>

              <p class="text-white fs-6 mb-0 mt-1 p-2">
                3.2 Change ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï (Output) ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (User) ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏±‡∏ô
              </p>

              <div class="mt-3 mb-1">
                <div v-for="(outcome_change,index) in Project_Data_P3.outcome_change" :key="index" class="mt-3">
                  <div v-if="index == 0">
                    <textarea type="text" class="form-control beautiful-box" v-model="outcome_change.value" style="max-width: 100%; min-width: 100%; height: 15px;" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 3.2.${index + 1}`"></textarea>
                  </div>
                  <div v-else>
                    <div class="row">
                      <div class="col-9">
                        <textarea type="text" class="form-control beautiful-box" v-model="outcome_change.value" style="max-width: 100%; min-width: 100%; height: 15px;" :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏ 3.2.${index + 1}`"></textarea>
                      </div>
                      <div class="col-3 d-flex justify-content-center align-items-center">
                        <button @click="decrease_outcome_change(index)" class="btn btn-danger">‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡πÄ‡∏õ‡∏•‡∏á‡∏ô‡∏µ‡πâ</button>
                      </div>
                    </div>
                  </div>
                </div>
                
              </div>
              <div class="d-flex justify-content-center">
                <button @click="addOutcomeChange" :disabled="is_outcome_change_limit" class="btn mt-3" style="width: 200px; background-color: #0d6efd; color: white;"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á </button>
              </div>
            </div>
            <div class="mb-3 mt-0">
              <span class="text-white fs-5 ">
                4. Impact
                ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö ‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏ß‡∏á‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏ã‡∏∂‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏´‡∏£‡∏∑‡∏≠ 2
                ‡∏´‡∏£‡∏∑‡∏≠ 3 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏î‡πâ ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏ö
              </span>

              <div class="row mt-4">
                <div 
                  v-for="(impact) in Project_Data_P3.impacts" 
                  :key="impact.id" 
                  class="row align-items-center mb-3"
                >
                  <!-- Left Column: Checkbox & Label -->
                  <div class="col-3 d-flex justify-content-between align-items-center ">
                    <input 
                      type="checkbox" 
                      class="form-check-input me-2 mx-5 circle-input" 
                      :id="impact.id" 
                      v-model="impact.isCheck"
                    >
                    <label class="form-check-label text-white" :for="impact.id">
                      {{ impact.title }}
                    </label>
                  </div>

                  <!-- Right Column: Input Field -->
                  <div class="col-9">
                    <textarea
                      type="text" 
                      class="form-control beautiful-box" 
                      :placeholder="`‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏`"
                      v-model="impact.value"
                      :disabled="!impact.isCheck"
                      style="height: 15px;"
                    ></textarea>
                  </div>
                </div>
              </div>

              <div class="mb-1 mt-0">
                <span class="text-white fs-5 mb-0">
                  5. ‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡πÅ‡∏õ‡∏•‡∏á (ToC)
                  ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ñ‡∏∂‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏™‡∏π‡πà‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß <br>"‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ .. (‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ø/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°) ... ‡πÅ‡∏•‡πâ‡∏ß
                            ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ ... (‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏Ø‡∏•‡∏Ø) (‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå) ..
                            ‡∏ô‡∏≥‡∏°‡∏≤‡∏™‡∏π‡πà ... (‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö) ..."
                  <br>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‚Äú‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡πÄ‡∏ï‡πâ‡∏≤‡∏ô‡∏°‡πÅ‡∏•‡∏∞‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏õ‡∏≤‡∏Å‡∏°‡∏î‡∏•‡∏π‡∏Å‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≠‡∏¢‡∏ï‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß
                      ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏î‡∏≠‡∏¢‡∏ï‡∏∏‡∏á‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô 
                      ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á
                      ‡∏ô‡∏≥‡∏°‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏ß‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‚Äù 
                </span>
                <div class="mt-3 mb-1 d-flex justify-content-center">
                  <textarea type="text" class="form-control beautiful-box" v-model="Project_Data_P3.toc" style="max-width: 100%; min-width: 100%;"
                    :placeholder="`‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏`"></textarea>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-6 d-flex justify-content-end">
                <router-link :to="{path:'/pl/no_income/p_2',query:{project_id: project_id || '',project_type:1}}">
                  <button class="btn btn-secondary" style="width: 140px;" @click="prevStep"
                    :disabled="currentStep === 1">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                </router-link>
              </div>
              <!-- <div class="col-6">
                <router-link :to="{path:'/pl/no_income/p_4',query:{project_id: project_id || '',project_type:1}}">
                  <button class="btn btn-success" style="width: 140px;" @click="nextStep" :disabled="currentStep === 7">
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                  </button>
                </router-link>
              </div> -->
              <div class="col-6"><button class="btn btn-success" style="width: 140px;" @click="submitForm"  :disabled="!isCanGo">
                    <!-- <router-link class="text-white text-decoration-none"  @click="nextStep" :to="{path:'/pl/no_income/p_2',query:{project_id: project_id || '',project_type:1}}"> -->
                      <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                    <!-- </router-link> -->
                  </button>
              </div>
            </div>
          </div>
        </div>
      </div>
  </div>
  
</template>

<script setup>
//api
import axios from 'axios'
import { useCookies } from "vue3-cookies";
import { useRoute,useRouter } from 'vue-router'
const  { cookies }  = useCookies();
//
import ProgressBar from '@/components/ProgressBar.vue'
import Loader from '@/components/Loader.vue';
import parseJwt from '../../../../../utils/DecodeToken';
import { ref, reactive, watch, onMounted, onUnmounted } from 'vue'
import NavbarProject from '@/components/NavbarProject.vue'
//swal
import Swal from 'sweetalert2'
const router = useRouter(); 
const loading = ref(false)
const Toast = Swal.mixin({
  toast: true,
  position: 'bottom-end',
//   iconColor: 'black',
  customClass: {
    popup: 'colored-toast',
  },
  showConfirmButton: false,
  timer: 3000,
  timerProgressBar: true,
  didOpen: (toast) => {
      toast.addEventListener('mouseenter', Swal.stopTimer)
      toast.addEventListener('mouseleave', Swal.resumeTimer)
    }
})

const currentStep = ref(3);

const project_id = ref(null)
const project_type = ref(null)
const user_id = ref(null)
const affiliation_id = ref(null)

let isInitialized = false
let canEdit = false
let isCanGo = false

var Project_Data_P3 = reactive({
  projectDetails: "", 
  projectObjectives: [ // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô
    {
      id: 1,
      value:'' // required
    },
  ], 
  input:[ // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô
    {
      id:1,
      value:'' // required
    }
  ],
  outputs: [ // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô
    {
      id:1,
      value:'' // required
    }
  ], 
  outcome_user: [ // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô
    {
      id:1,
      value:'' // required
    }
  ],
  outcome_change: [ // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô
    {
      id:1,
      value:'' // required
    }
  ], 
  impacts: [ // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏±‡∏ô
    {
      id: 1,
      title: '‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à',
      isCheck: false, //if true, value can not be a empty
      value: '' 
    },
    {
      id: 2,
      title: '‡∏™‡∏±‡∏á‡∏Ñ‡∏°',
      isCheck: false, //if true, value can not be a empty
      value:''
    },
    {
      id: 3,
      title: '‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°',
      isCheck: false, //if true, value can not be a empty
      value:''
    }
  ],
  toc: ""  // required
})


const objective_limit = 6
const is_objective_limit = ref(false)
const addObjective = () => {
  if (Project_Data_P3.projectObjectives.length >= objective_limit) {
    is_objective_limit.value = true;
    return; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏•‡∏¥‡∏°‡∏¥‡∏ï
  }

  Project_Data_P3.projectObjectives.push({
    id: Project_Data_P3.projectObjectives.length + 1,
    value: ''
  });

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ñ‡∏∂‡∏á‡∏•‡∏¥‡∏°‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  if (Project_Data_P3.projectObjectives.length >= objective_limit) {
    is_objective_limit.value = true;
  }
}
const decrease_Objective = (index) => {
  if (Project_Data_P3.projectObjectives.length > 1) {
    Project_Data_P3.projectObjectives.splice(index, 1);

    Project_Data_P3.projectObjectives.forEach((obj, i) => {
      obj.id = i + 1
    })

    if (Project_Data_P3.projectObjectives.length < objective_limit) {
      is_objective_limit.value = false;
    }
  }
}

const input_limits = 6
const is_input_limit = ref(false)
const addInput = () => {
  if (Project_Data_P3.input.length >= input_limits) {
    is_input_limit.value = true;
    return
  }

  Project_Data_P3.input.push({
    id: Project_Data_P3.input.length + 1,
    value: ''
  })

  if (Project_Data_P3.input.length >= input_limits) {
    is_input_limit.value = true;
  }
}

const decrease_input = (index) => {
  if (Project_Data_P3.input.length > 1) {
    Project_Data_P3.input.splice(index, 1);

    Project_Data_P3.input.forEach((obj, i) => {
      obj.id = i + 1
    })

    if (Project_Data_P3.input.length < input_limits) {
      is_input_limit.value = false;
    }
  }
}

const output_limits = 6
const is_output_limit = ref(false)
const addOutput = ()=>{
  if (Project_Data_P3.outputs.length >= output_limits) {
    is_output_limit.value = true;
    return
  }

  Project_Data_P3.outputs.push({
    id: Project_Data_P3.outputs.length + 1,
    value: ''
  })

  if (Project_Data_P3.outputs.length >= output_limits) {
    is_output_limit.value = true;
  }
}
const decrease_output = (index) => {
  if (Project_Data_P3.outputs.length > 1) {
    Project_Data_P3.outputs.splice(index, 1);

    Project_Data_P3.outputs.forEach((obj, i) => {
      obj.id = i + 1
    })

    if (Project_Data_P3.outputs.length < output_limits) {
      is_output_limit.value = false;
    }
  }
}

const outcome_user_limits = 6
const is_outcome_user_limit = ref(false)
const addOutcomeUser = ()=>{
  if (Project_Data_P3.outcome_user.length >= outcome_user_limits) {
    is_outcome_user_limit.value = true;
    return
  }

  Project_Data_P3.outcome_user.push({
    id: Project_Data_P3.outcome_user.length + 1,
    value: ''
  })

  if (Project_Data_P3.outcome_user.length >= outcome_user_limits) {
    is_outcome_user_limit.value = true;
  }
}
const decrease_outcome_user = (index) => {
  if (Project_Data_P3.outcome_user.length > 1) {
    Project_Data_P3.outcome_user.splice(index, 1);

    Project_Data_P3.outcome_user.forEach((obj, i) => {
      obj.id = i + 1
    })

    if (Project_Data_P3.outcome_user.length < outcome_user_limits) {
      is_outcome_user_limit.value = false;
    }
  }
}

const outcome_change_limits = 6
const is_outcome_change_limit = ref(false)
const addOutcomeChange = ()=>{
  if (Project_Data_P3.outcome_change.length >= outcome_change_limits) {
    is_outcome_change_limit.value = true;
    return
  }

  Project_Data_P3.outcome_change.push({
    id: Project_Data_P3.outcome_change.length + 1,
    value: ''
  })

  if (Project_Data_P3.outcome_change.length >= outcome_change_limits) {
    is_outcome_change_limit.value = true;
  }
}
const decrease_outcome_change  = (index) => {
  if (Project_Data_P3.outcome_change.length > 1) {
    Project_Data_P3.outcome_change.splice(index, 1);

    Project_Data_P3.outcome_change.forEach((obj, i) => {
      obj.id = i + 1
    })

    if (Project_Data_P3.outcome_change.length < outcome_change_limits) {
      is_outcome_change_limit.value = false;
    }
  }
}

function debounce(func, delay) {
  let timer
  return function (...args) {
    clearTimeout(timer)
    timer = setTimeout(() => {
      func.apply(this, args)
    }, delay)
  }
}

const getDataWhenProjectID = async ()=>{
  try{
    const response = await axios.post('http://localhost:5000/pl/get/p_3',{
      project_id: project_id.value, 
      project_type: project_type.value,
      project_user: user_id.value,
    })
    
    const project_data = JSON.parse(response.data.data[0].project_data_p_3)
    //console.log(project_data)
    Project_Data_P3.projectDetails = project_data.projectDetails
    Project_Data_P3.projectObjectives =  project_data.projectObjectives
    Project_Data_P3.input = project_data.input
    Project_Data_P3.outputs =  project_data.outputs
    Project_Data_P3.outcome_user = project_data.outcome_user
    Project_Data_P3.outcome_change = project_data.outcome_change
    Project_Data_P3.impacts = project_data.impacts
    Project_Data_P3.toc = project_data.toc

    // //console.log('sending a request to fetch editing data project id = ',project_id)
  }catch(err){
    //console.log(err)
    //console.log('error fetching editing data = ',project_id.value)
  }
}

const autoSave = debounce(async () => {
  try {

    const response = await axios.post('http://localhost:5000/pl/p_3/no_income/save', { 
    project_id: project_id.value, 
    project_type: project_type.value,
    project_user: user_id.value,
    project_data: Project_Data_P3 ,
    project_affiliation: affiliation_id.value 
  })
    //console.log(response.data)
    if(response.data.success){
      project_id.value = response.data.insert_id;
      //console.log('project_id',project_id.value)
      router.replace({path:'/pl/no_income/p_4',query:{project_id: project_id.value || '', project_type:1}})
       Toast.fire({
                    icon: 'success',
                    iconColor: 'green',
                    title: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,
                })
                await setTimeout(() => {
                loading.value = false
              }, 500)
      }else{
         Toast.fire({
                    icon: 'error',
                    iconColor: 'red',
                    title: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà`,
                })
      }
    
  } catch (error) {
    console.error(error)
     Toast.fire({
                    icon: 'error',
                    iconColor: 'red',
                    title: `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà`,
                })
  }
}, 3000) 
 


const submitForm = async ()=>{
  loading.value = true
  await autoSave()
  nextStep()
}

// watch(
//       Project_Data_P3,
//       (newVal) => {
//         if (!newVal.projectDetails.trim()) {
//           isCanGo = false;
//           return;
//         }

//         const mustFilledArrays = [
//           newVal.projectObjectives,
//           newVal.input,
//           newVal.outputs,
//           newVal.outcome_user,
//           newVal.outcome_change
//         ];

//         const hasEmptyField = mustFilledArrays.some(arr =>
//           arr.some(item => !item.value || item.value.trim() === '')
//         );
//         if (hasEmptyField) {
//           isCanGo = false;
//           return;
//         }

//         const hasInvalidImpact = newVal.impacts.some(imp =>
//           imp.isCheck && (!imp.value || imp.value.trim() === '')
//         );
//         if (hasInvalidImpact) {
//           isCanGo = false;
//           return;
//         }

//         if (!newVal.toc || newVal.toc.trim() === '') {
//           isCanGo = false;
//           return;
//         }

//         isCanGo = true;
//       },
//       { deep: true, immediate: true }
//     );

watch(
  Project_Data_P3,
  (newVal) => {
    //console.log('--- Checking Project_Data_P3 ---');
    
    if (!newVal.projectDetails?.trim()) {
      //console.log('‚ùå projectDetails is empty');
      isCanGo = false;
      return;
    }
    //console.log('‚úÖ projectDetails:', newVal.projectDetails);

    const mustFilledArrays = [
      newVal.projectObjectives,
      newVal.input,
      newVal.outputs,
      newVal.outcome_user,
      newVal.outcome_change
    ];

    const hasEmptyField = mustFilledArrays.some(arr =>
      !Array.isArray(arr) || arr.some(item => !item.value || item.value.trim() === '')
    );
    if (hasEmptyField) {
      //console.log('‚ùå Found empty fields in one of the required arrays');
      isCanGo = false;
      return;
    }
    //console.log('‚úÖ All fields in required arrays are filled');

    if (!Array.isArray(newVal.impacts)) {
      //console.log('‚ùå impacts is not an array');
      isCanGo = false;
      return;
    }
    const hasInvalidImpact = newVal.impacts.some(imp =>
      imp.isCheck && (!imp.value || imp.value.trim() === '')
    );
    if (hasInvalidImpact) {
      //console.log('‚ùå Selected impacts have empty value fields');
      isCanGo = false;
      return;
    }
    //console.log('‚úÖ impacts are valid');

    if (!newVal.toc?.trim()) {
      //console.log('‚ùå toc is empty');
      isCanGo = false;
      return;
    }
    //console.log('‚úÖ toc:', newVal.toc);

    //console.log('üéâ All fields are filled, isCanGo = true');
    isCanGo = true;
  },
  { deep: true, immediate: true }
);


onMounted( async ()=>{
  const route = useRoute(); 
  const user = parseJwt(cookies.get('accesstoken'))
  user_id.value = user.user_id
  affiliation_id.value = user.affiliation_id
  
  
  if(route.query.project_type){
    const projectType = route.query.project_type; 
    project_type.value = projectType
  }

  if(route.query.project_id){
    const projectId = route.query.project_id; 
    project_id.value = projectId

    isInitialized = true
    canEdit = false // true
    await getDataWhenProjectID()
    canEdit = true
  }else{
    isInitialized = true
    canEdit = true //false 
  }
  //console.log('Project id:', project_id.value)
  //console.log('Project Type:', project_type.value)
  //console.log('user_id:', user_id.value)
})

watch(Project_Data_P3, (newVal, oldVal) => {
  //console.log('Project_Data_P3 has changed:');
  if(isInitialized && !canEdit){
    //console.log('return when fetching state')
    return 0
  }
}, { deep: true })
onUnmounted(()=>{
  window.addEventListener("beforeunload", (event) => {
    event.preventDefault();
  })
})

const nextStep = () => {
  if (currentStep.value < 7) {
    currentStep.value++;
  }
};

const prevStep = () => {
  if (currentStep.value > 1) {
    currentStep.value--;
  }
};
</script>

<style scoped>
.custom-input-four {
  /* width: 100%;
  border-radius: 5px; */
  max-width: 100%;
  min-width: 300px; 
}

.beautiful-box {
  min-height: 50px;
  border-radius: 6px;
  resize: vertical;
}


.circle-input{
  border-radius: 50%;
  width: 20px;
  height: 20px;
  background-color: transparent;
  border: 1px solid white;
}

.custom-input {
        width: 100%; 
        text-align: left; 
    }
</style>